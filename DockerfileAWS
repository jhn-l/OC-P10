# Base image plus flexible avec apt-get
FROM python:3.12-slim

# DÃ©finition du rÃ©pertoire de travail
WORKDIR /var/task

# ğŸ”¹ Installer les dÃ©pendances systÃ¨me pour compiler `scikit-surprise`
RUN apt-get update && apt-get install -y gcc g++ make libstdc++-dev

# ğŸ”¹ DÃ©finition des variables d'environnement pour Ã©viter les erreurs de `surprise`
ENV SURPRISE_DATASET_DIR=/tmp

# ğŸ”¹ Installer les dÃ©pendances Python dans `/var/task`
RUN pip install --no-cache-dir pandas numpy scikit-learn scikit-surprise boto3 \
    --target /var/task

# ğŸ”¹ Copier le fichier source
COPY hybrid_recommender.py .

# ğŸ”¹ Ajouter le runtime AWS Lambda (sinon lâ€™exÃ©cution Ã©chouera)
RUN pip install --no-cache-dir awslambdaric

# ğŸ”¹ DÃ©finir le point d'entrÃ©e pour AWS Lambda
CMD ["python3", "-m", "awslambdaric", "hybrid_recommender.lambda_handler"]
